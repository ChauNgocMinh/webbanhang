@model Cart
@{
    ViewData["Title"] = "Giỏ hàng";
    var x = 0.0;
    var IdCart = ViewBag.IdCart;
}

<style>
    input[type="number"]:focus::-webkit-inner-spin-button,
    input[type="number"]:focus::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }
    input[type="number"]:hover::-webkit-inner-spin-button,
    input[type="number"]:hover::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }
    input[type="number"] {
        -moz-appearance: textfield; 
    }
    .back-link {
        padding: 10px;
        color: #515154;
        font-size: 13px;
    }
    .back-link a {
        margin: 0 5px;
        color: #515154;
    }
    .cart{
        display: flex;
        width: 100%;
        padding-bottom: 20px;
    }
    .cart .order{
        width: 70%;
    }
    .cart .item-box {
        margin-right: 15px;
        padding: 16px 16px;
        border-radius: 8px;
        background: #fff;
        
    }
    .cart table{
        width: 100%;
    }
    table tr th {
        border-style: none !important;
        font-weight: 700;
        font-size: 15px;
        color: #1D1D1F;
        padding: 16px 16px;
    }
    table tr td {
        padding: 20px 16px;
    }
    .cart .title-checkout {
        margin: 24px 0 20px;
        font-weight: 700;
        font-size: 21px;
        line-height: 36px;
        color: #1D1D1F;
        margin-bottom: 15px;
        margin-top: 15px;
    }
    .info-order input{
        padding: 8px;
        border: 1px solid #EBEBEB;
        border-radius: 8px;
        height: 48px;
    }
    
    .info-order label{
        font-weight: 700;
        font-size: 15px;
        color: #1D1D1F;
    }
    .info-order .input{
        margin: 0 0 20px 0;
    }

    .cart .total-bill{
        width: 30%;
    }

    .show-all a {
        text-decoration: none;
        border: 1px solid #0066CC;
        border-radius: 8px;
        padding: 5.5px 45px;
        color: #0066CC;
        font-weight: 400;
        font-size: 12px;
        line-height: 27px;
        display: inline-block;
        vertical-align: middle;
    }

    @@media(max-width: 500px){
        table tr td {
            padding: 5px;
        }
    }
    @@media(max-width: 1000px){
        .cart{
            display: block;
        }
        .cart .order {
            width: 100%;
        }

        .cart .item-box {
            margin-right: 0;
        }

        .cart .total-bill {
            width: 100%;
            margin-bottom: 20px;
        }
    }
</style>

<div class="back-link">
    <div class="container">
        <a asp-action="" asp-controller="Home">Trang chủ</a> > <a>Giỏ hàng</a>
    </div>
</div>   
<div style="background: #f5f5f7;padding-top: 13px;">
    <div class="container cart">
        @if (Model.Id == Guid.Empty || Model.CartItems.Count < 1)
        {
            <i>
                Giỏ hàng của bạn đang trống!
            </i>
        } 
        else 
        {
            <div class="order">
                <div class="item-box">
                    <table>
                        <thead style="border-bottom: 1px solid #d2d2d7;">
                            <tr>
                                <th scope="col">Hình ảnh</th>
                                <th scope="col">Tên sản phẩm</th>
                                <th scope="col">Giá bán</th>
                                <th scope="col">Số lượng</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.CartItems)
                            {
                                <tr>
                                    <td><img style="height: 80px; width: 64px;" src="/image/Product/@item.Image" alt="" srcset=""></td>
                                    <td style="border-style: none !important; font-weight: 700; font-size: 15px; color: #1D1D1F; min-height: 0px;">@item.ProductName</td>
                                    <td style="border-style: none !important; font-weight: 700; font-size: 15px; color: #1D1D1F; min-height: 0px;">@item.Price.ToString("#,0")₫</td>
                                    <td style="min-width: 90px;">
                                        <a asp-action="ChangeNumber" asp-route-Id="@item.Id" asp-route-number="-1" asp-route-IdCart=@IdCart class="btn">-</a>
                                            @item.Quantity
                                        <a asp-action="ChangeNumber" asp-route-Id="@item.Id" asp-route-number="1" asp-route-IdCart=@IdCart class ="btn">+</a>
                                    </td>
                                    <td>
                                        <a style="color:#777" asp-action="ChangeNumber" asp-route-Id="@item.Id" asp-route-number="-1" asp-route-IdCart=@IdCart>
                                            <i class="fa-solid fa-trash"></i>
                                        </a>
                                    </td>
                                </tr>
                                x += item.Price;
                            }
                        </tbody>
                    </table>
                    <div class="show-all d-flex justify-content-end">
                        <a asp-action="Index" asp-controller="Home">Tiếp tục mua sắm</a>
                    </div>
                </div>
                <div class="title-checkout">
                    Thông tin thanh toán
                </div>
                <div class="item-box">
                    <div class="info-order">
                        <label>Giao hàng tận nơi</label>
                        <div class="input row">
                            <input id="Name" class="w-100" type="text" placeholder ="Tên"/>
                        </div>
                        <div class="input row justify-content-between">
                            <input style="width: 49%" id="Phone" type="number" placeholder="Số điện thoại" />
                            <input style="width: 49%" id="Email" type="text" placeholder="Email" />
                        </div>
                        <label>Địa chỉ</label>
                        <div class="row input justify-content-between">
                            <div style="width: 49%; padding: 0;">
                                <label for="province"  style="display: block;text-align: left;font-weight: 400; font-size: 13px; color: #1D1D1F; margin-bottom: 5px;">Tỉnh, thành phố:</label>
                                <input type="text" style="padding: 8px; border: 1px solid #EBEBEB; border-radius: 8px; height: 48px;" id="province" class="w-100" />
                            </div>
                            <div style="width: 49%; padding: 0;">
                                <label for="district" style="display: block;text-align: left;font-weight: 400; font-size: 13px; color: #1D1D1F; margin-bottom: 5px;">Quận, huyện:</label>
                                @* <select style="padding: 8px; border: 1px solid #EBEBEB; border-radius: 8px; height: 48px;" id="province" id="district" class="w-100">
                                </select> *@
                                <input type="text" style="padding: 8px; border: 1px solid #EBEBEB; border-radius: 8px; height: 48px;" id="district" class="w-100" />
                            </div>
                        </div>
                        <div class="row input">
                            <label style="display: block;text-align: left;font-weight: 400; font-size: 13px; color: #1D1D1F; margin-bottom: 5px; padding: 0">Địa chỉ cụ thể:</label>
                            <input id="Address" class="w-100" type="text" />
                        </div>
                    </div>
                </div>
                <div class="title-checkout">
                    Phương thức thanh toán  
                </div>
                <div class="item-box mb-3">
                    <div class="pay-method">
                        <span style="display: block; text-align: left; font-weight: 400; font-size: 13px; color: #1D1D1F; margin-bottom: 5px; padding: 0;">
                            Quý khách vui lòng lựa chọn các hình thức thanh toán dưới đây:
                        </span>
                        <div class="row">
                            <div class="radio-container" style="width: 49%">
                                <input type="radio" id="paypal" name="options" class="radio-input">
                                <label for="option1" class="radio-label">Thanh toán Paypal</label>
                            </div>
                            <div class="radio-container" style="width: 49%">
                                <input type="radio" id="vnpay" name="options" class="radio-input">
                                <label for="option2" class="radio-label">Thanh toán VN Pay</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="total-bill" style="padding: 16px 16px; border-radius: 8px; background: #fff; height: 100%">
                <div class="">
                    <div class="row m-0" style="padding: 24px 0;">
                        <input class="col-7" style="height: 47px; border-radius: 8px 0 0 8px;  border: 1px solid #EBEBEB;" type="text" placeholder="Mã giảm giá" /><button style="height: 47px; color: white; border-radius: 0 8px 8px 0; border: none; font-size: 15px;background-color: #999;" class="col-5">
                            Áp dụng
                        </button>
                    </div>
                    <div style="padding: 5px 0px 15px; margin: 0 0 20px; border-bottom: 1px solid #ddd;">
                        <div class="d-flex justify-content-between">
                            <label style="font-weight: 400; font-size: 14px; line-height: 24px; color: #86868B;">Tổng phụ:</label>
                            <label style="font-weight: 700; font-size: 14px; line-height: 24px; color: #1d1d1f;">@x.ToString("#,0")₫</label>
                        </div>
                        <div class="d-flex justify-content-between">
                            <label style="font-weight: 700; font-size: 14px; line-height: 24px; color: #1d1d1f;">Tổng cộng:</label>
                            <label style="color: #0066CC; font-weight: bold; font-size: 17px;">@x.ToString("#,0")₫</label>
                        </div>
                    </div>
                    <div>
                        <button onclick="proceedPayment()" class="d-flex justify-content-center align-items-center" style="border: none; background-color: #0066cc; padding: 10px 20px; font-size: 16px; color: #fff; border-radius: 8px;  height: 48px; font-size: 14px; width: 100%">
                            Tiến hành đặt hàng
                        </button>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

<script>
    $(document).ready(function () {
        var districtData = {
            tp_ho_chi_minh: ["Quận 1", "Quận 2", "Quận 3", "Quận 4", "Quận 5", "Quận 6", "Quận 7", "Quận 8", "Quận 9", "Quận 10", "Quận 11", "Quận 12"],
            ha_noi: ["Quận Ba Đình", "Quận Hoàn Kiếm", "Quận Hai Bà Trưng", "Quận Đống Đa", "Quận Tây Hồ", "Quận Cầu Giấy", "Quận Thanh Xuân", "Quận Hoàng Mai", "Quận Long Biên", "Quận Bắc Từ Liêm", "Quận Nam Từ Liêm", "Quận Hà Đông"],
            hai_phong: ["Quận Hồng Bàng", "Quận Ngô Quyền", "Quận Lê Chân", "Quận Hải An", "Quận Kiến An", "Quận Đồ Sơn"],
            // Thêm các quận huyện cho các tỉnh thành khác tương tự
        };
        function populateDistricts(province) {
            var districtSelect = $("#district");
            districtSelect.empty();
            districtSelect.append("<option value=''>Chọn quận, huyện</option>");
            if (districtData.hasOwnProperty(province)) {
                districtData[province].forEach(function (district) {
                    districtSelect.append("<option value='" + district + "'>" + district + "</option>");
                });
            }
        }
        $("#province").on("change", function () {
            var selectedProvince = $(this).val();
            populateDistricts(selectedProvince);
        });
        populateDistricts($("#province").val());
    });

    function proceedPayment() {
        let paymentType = -1;

        if (document.getElementById("vnpay").checked) {
            paymentType = 1;
        } else if (document.getElementById("paypal").checked) {
            paymentType = 0;
        }

        var orderViewModel = {
            InfoOrder: {
                Status: 1,
                PaymentMethod: true,
                Name: $("#Name").val(),
                Phone: $("#Phone").val(),
                Email: $("#Email").val(),
                City: $("#province").val(),
                District: $("#district").val(),
                Address: $("#Address").val(),
                Total: @x
            },
            OrderItem: []
        };
        if (!orderViewModel.InfoOrder.Name ||
            !orderViewModel.InfoOrder.Phone ||
            !orderViewModel.InfoOrder.Email ||
            !orderViewModel.InfoOrder.City ||
            !orderViewModel.InfoOrder.District ||
            !orderViewModel.InfoOrder.Address) {
            alert("Vui lòng điền đầy đủ thông tin");
            return;
        }
        if (paymentType === -1) {
            alert("Vui lòng chọn phương thức thanh toán");
            return;
        }
        @foreach (var item in Model.CartItems)
        {
            <text>
                    orderViewModel.OrderItem.push({
                        ProductId: "@item.ProductId",
                        Price: @item.Price,
                        Quantity: @item.Quantity,
                        ProductName: "@item.ProductName",
                        Image: "@item.Image",
                    });
            </text>
        }

        $.ajax({
            type: "POST",
            url: `/Order/ProceedPayment?paymentType=${paymentType}&cartId=${localStorage.getItem("Cart Id")}`,
            data: orderViewModel,
            success: function (result) {
                window.location.href = result;
            },
            error: function (jqXHR, textStatus, errorThrown) {
                console.log(textStatus);
                console.log(errorThrown);
            }
        });
    }
</script>